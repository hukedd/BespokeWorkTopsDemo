var stage,layer,imgDataUrl,imgName,backLeftCurveYes,frontLeftCurveYes,backRightCurveYes,showGrid=!0,sinkPositionFromTop=350,sinkPositionFromFront=100,sinkPositionFromLeft=100,isSinkRequired=!1,defaultSinkWidth=730,defaultSinkLength=500,defaultAllSides=100,sinkTypes=[{name:"Single",width:648,length:404},{name:"Super Large Bowl",width:868,length:462},{name:"1.5 Duo Bowl",width:866,height:462},{name:"1.5 Desginer Bowl",width:866,length:482}],sinkMaterial=[{name:"Stainless Steel"},{name:"Acrylic"}],bowlHandlingTypes=[{name:"Left Hand Bowl / Right Hand Drainer"},{name:"Right Hand Bowl / Left Hand Drainer"}];const edgeThickness=5,gridSize=50,gridcolour="#000000";var coloursList=[{name:"Minerva Sparkling White",image:"minerva-sparkling-white.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Carrara White",image:"minerva-carrara-white.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Ice Crystal",image:"minerva-ice-crystal.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Grey Crystal",image:"minerva-grey-crystal.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Copper Fleck",image:"minerva-copper-fleck.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Ice Blue",image:"minerva-ice-blue.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Fossil",image:"minerva-fossil.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Caramel Crunch",image:"minerva-caramel-crunch.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Desert Rock",image:"minerva-desert-rock.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Amazonia Brown",image:"minerva-amazonia-brown.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Peak Stone",image:"minerva-peak-stone.jpg",range:"minerva",invertcolours:!1,invertGrid:!0},{name:"Minerva Nimbus Grey",image:"minerva-nimbus-grey.jpg",range:"minerva",invertcolours:!0,invertGrid:!0},{name:"Minerva Black Granite",image:"minerva-black-granite.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Concrete Haze",image:"minerva-concrete-haze.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Travertine Haze",image:"minerva-travertine-haze.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Silver Haze",image:"minerva-silver-haze.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Minerva Calcutta White",image:"minerva-calcutta-white.jpg",range:"minerva",invertcolours:!1,invertGrid:!1},{name:"Maia Iceberg",image:"maia-iceberg.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Snow Haze",image:"maia-snow-haze.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Cristello",image:"maia-cristello.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Vanilla",image:"maia-vanilla.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Calcite",image:"maia-calcite.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Beige Sparkle",image:"maia-beige-sparkle.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Fossil",image:"maia-fossil.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Cappuccino",image:"maia-cappuccino.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Latte",image:"maia-latte.jpg",range:"maia",invertcolours:!1,invertGrid:!1},{name:"Maia Brazillian Greige",image:"maia-brazillian-greige.jpg",range:"maia",invertcolours:!0,invertGrid:!0},{name:"Maia Lava",image:"maia-lava.jpg",range:"maia",invertcolours:!0,invertGrid:!0},{name:"Maia Mocha",image:"maia-mocha.jpg",range:"maia",invertcolours:!0,invertGrid:!0},{name:"Maia Greystone",image:"maia-greystone.jpg",range:"maia",invertcolours:!0,invertGrid:!0},{name:"Maia Galaxy",image:"maia-galaxy.jpg",range:"maia",invertcolours:!0,invertGrid:!0},{name:"Maia Vulcano",image:"maia-vulcano.jpg",range:"maia",invertcolours:!0,invertGrid:!0}];function loadColourDropdown(){var e,a=document.getElementById("rangeSelect"),n=a.options[a.selectedIndex].value;(e=document.getElementById("colourSelect")).innerHTML="",(r=document.createElement("option")).text="Select",r.value="0",e.appendChild(r);for(let a of coloursList){var r;if(a.range===n)(r=document.createElement("option")).text=a.name,r.value=a.name,e.appendChild(r)}(e=document.getElementById("colourSelect")).value="Minerva Copper Fleck",loadColourPreview()}function loadColourPreview(){document.getElementById("colourPreview").style.display="block";var e=document.getElementById("colourSelect"),a=document.getElementById("colourPreview"),n=e.options[e.selectedIndex].value;if(console.log(n),"0"!==n){var r=coloursList.find((e=>e.name===n));a.src="/images/"+r.range+"/"+r.image,a.title=r.name}else a.src=""}function hideImg(){document.getElementById("colourPreview").style.display="none",imgDataUrl=""}function loadAdjustViewLabel(){var e=document.getElementById("percentValue"),a=document.getElementById("adjustView").value;e.innerHTML=10*a+"%";var n=document.getElementById("innerCanvasDiv");n.style.transformOrigin="0 0",n.style.transform=`scale(${10*a/100})`}loadColourDropdown(),loadAdjustViewLabel();const colourPreview=document.getElementById("colourPreview");function CreateCanvas(e,a,n){stage=new Konva.Stage({container:"konvaContainer",width:e,height:a}),layer=new Konva.Layer,stage.add(layer),drawGrid(n)}function createHRuler(e){var a=$(".hruler");a.html("");for(var n=0,r=0;n<(e+5)/5;n++,r++){var t=$("<div>");0==r?t.addClass("tickLabel").html(5*n):[1,3,5,7,9].indexOf(r)>-1?(t.addClass("tickMinor"),9==r&&(r=-1)):t.addClass("tickMajor"),a.append(t)}}function createVRuler(e){var a=$(".vruler");a.html("");for(var n=0,r=0;n<(e+5)/5;n++,r++){var t=$("<div>");0==r?t.addClass("tickLabel").html(5*n):[1,3,5,7,9].indexOf(r)>-1?(t.addClass("tickMinor"),9==r&&(r=-1)):t.addClass("tickMajor"),a.append(t);let i=32+(e-100)/100*50;document.getElementById("vruler").style.top=i+"px",document.getElementById("vruler").style.left="-"+(i-10)+"px"}}colourPreview.addEventListener("load",(e=>{console.log(e.target.src);var a=e.target.src,n=e.target.title;console.log(a),imgDataUrl=a,imgName=n}));var gridLayer=new Konva.Layer;function drawGrid(e){gridLayer.destroy();for(let e=0;e<stage.width();e+=gridSize)gridLayer.add(new Konva.Line({points:[e,0,e,stage.height()],stroke:gridcolour,strokeWidth:1}));for(let e=0;e<stage.height();e+=gridSize)gridLayer.add(new Konva.Line({points:[0,e,stage.width(),e],stroke:gridcolour,strokeWidth:1}));gridLayer.clearCache(),!0===e&&(gridLayer.cache(),gridLayer.filters([Konva.Filters.Invert])),stage.add(gridLayer)}const toggleGridCheckbox=document.getElementById("toggleGrid");toggleGridCheckbox.addEventListener("change",(function(){toggleGridCheckbox.checked?gridLayer.show():gridLayer.hide()})),toggleGridCheckbox.click();const toggleJoinCheckbox=document.getElementById("toggleJoin");toggleJoinCheckbox.addEventListener("change",(function(){toggleJoinCheckbox.checked?horizontalLayer.show():horizontalLayer.hide()}));const toggleSinkBoundaryCheckbox=document.getElementById("toggleSinkBoundary");toggleSinkBoundaryCheckbox.addEventListener("change",(function(){toggleSinkBoundaryCheckbox.checked?sinkBoundary.show():sinkBoundary.hide()}));const horizontalLayer=new Konva.Layer,verticalLayer=new Konva.Layer;function joinLines(){const e=[25,25];for(let a=150;a<=stage.height();a+=50){horizontalLayer.add(new Konva.Line({points:[12.5,a,stage.width(),a],stroke:"red",strokeWidth:2,dash:e}));break}for(let a=150;a<=stage.width();a+=50){verticalLayer.add(new Konva.Line({points:[a,12.5,a,stage.height()],stroke:"red",strokeWidth:2,dash:e}));break}horizontalLayer.clearCache(),stage.add(horizontalLayer)}var sinkBoundary=new Konva.Layer;function addSinkBoundary(e,a,n,r){(sinkBoundary=new Konva.Rect({x:defaultAllSides+n,y:a-defaultSinkLength-defaultAllSides,width:e-2*defaultAllSides-(n+r),height:defaultSinkLength,dash:[5,5],stroke:"blue"})).clearCache(),layer.add(sinkBoundary),toggleSinkBoundaryCheckbox.checked?sinkBoundary.show():sinkBoundary.hide()}function downloadURI(e,a){var n=document.createElement("a");n.download=a,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),delete n}function CreateWorktop(){const e=parseInt(document.getElementById("widthInput").value),a=parseInt(document.getElementById("lengthInput").value),n=parseInt(25),r=parseInt(document.getElementById("borderRadiusInput").value),t=document.getElementById("leftEdgeYes").checked,i=document.getElementById("frontEdgeYes").checked,o=document.getElementById("rightEdgeYes").checked,d=document.getElementById("backEdgeYes").checked;backLeftCurveYes=document.getElementById("backLeft").checked,backRightCurveYes=document.getElementById("backRight").checked,frontRightCurveYes=document.getElementById("frontRight").checked,frontLeftCurveYes=document.getElementById("frontLeft").checked;var l=document.getElementById("sinkRequiredSelect"),g=l.options[l.selectedIndex].value;if(isSinkRequired="yes"===g,imgDataUrl&&e&&a&&n&&r>=0){var c=coloursList.find((e=>e.name===imgName)).invertGrid,m=coloursList.find((e=>e.name===imgName)).invertcolours,s=backLeftCurveYes?r:0,u=backRightCurveYes?r:0,v=frontRightCurveYes?r:0,h=frontLeftCurveYes?r:0,k=0,y=0,f=r,p=r;(backLeftCurveYes||frontLeftCurveYes)&&(k=r),(backRightCurveYes||frontRightCurveYes)&&(y=r),backLeftCurveYes||frontLeftCurveYes||(f=0),backRightCurveYes||frontRightCurveYes||(p=0),a>2*defaultAllSides+defaultSinkLength+k&&!frontLeftCurveYes&&(k=0,f=0),a>2*defaultAllSides+defaultSinkLength+y&&!frontRightCurveYes&&(y=0,p=0),CreateCanvas(e,a,c),createHRuler(e),createVRuler(a);var w=new Image;w.src=imgDataUrl,w.onload=function(){var n=new Konva.Group,l=new Konva.Rect({width:e,height:a,fill:"transparent"}),g=new Konva.Rect({x:2.5,y:2.5,width:e-5,height:a-5,cornerRadius:[s,u,v,h],fillPatternImage:w,fillPatternScale:{x:1,y:1},fillPatternOffset:{x:-2.5,y:-2.5},stroke:"#D3B683",strokeWidth:5}),c=t?5:0,m=d?5:0,f=o&&t?10:o?5:0,p=i&&d?10:i?5:0,L=new Konva.Rect({x:c,y:m,width:e-f,height:a-p,cornerRadius:[s,u,v,h],fillPatternImage:w,strokeWidth:5});n.add(l),n.add(g),n.add(L),layer.add(n);var C=new Konva.Group({x:sinkPositionFromLeft+r,y:sinkPositionFromTop,draggable:!0,dragBoundFunc:function(n){return{x:Math.max(102.5+r,Math.min(n.x,e-2.5-700-r)),y:Math.max(102.5,Math.min(n.y,a-2.5-440))}}}),I=400,B=new Konva.Rect({x:0,y:0,width:I,height:340,fill:"transparent",stroke:"black",strokeWidth:3,cornerRadius:5}),S=new Konva.Circle({x:200,y:170,radius:15,fill:"black"});C.add(B),C.add(S);for(let e=0;e<5;e++){var M=new Konva.Line({points:[I,20+70*e,600,20+70*e],stroke:"black",strokeWidth:3});C.add(M)}layer.batchDraw(),!0===isSinkRequired&&addSinkBoundary(e,a,k,y)};const n=new Konva.Image({x:defaultAllSides+f+(e-2*defaultAllSides-(k+y)-defaultSinkWidth)/2,y:a-defaultSinkLength-defaultAllSides,draggable:!0,dragBoundFunc:function(r){var t=Math.max(defaultAllSides+f,Math.min(r.x,e-defaultSinkWidth-p-defaultAllSides)),i=Math.max(a-defaultSinkLength-defaultAllSides,Math.min(r.y,a-defaultSinkWidth));return document.getElementById("topInput").value=Math.round(n.y()),document.getElementById("leftInput").value=Math.round(n.x()),{x:t,y:i}}});!0===isSinkRequired?(document.getElementById("topInput").value=Math.round(n.y()),document.getElementById("leftInput").value=Math.round(n.x())):(document.getElementById("topInput").value="",document.getElementById("leftInput").value="");const l=new Image;l.src="/images/sample-sink.png",l.onload=function(){n.image(l),n.cache(),!0===m&&n.filters([Konva.Filters.Invert]),!0===isSinkRequired&&layer.add(n),layer.draw()},joinLines(),layer.batchDraw()}else alert("Please check colour, width, height, thickness, curve values")}